<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ—¥æœ¬åœ°å›¾ - æŒ‰åœ°æ–¹åŒºåˆ†</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        overflow: hidden;
      }

      .container {
        max-width: 100%;
        height: calc(100vh - 40px);
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
      }

      .map-container {
        width: 100%;
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background: #e7c2c2;
        border-radius: 10px;
        overflow: hidden;
      }

      #map {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .geolonia-svg-map {
        width: auto;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
      }

      .geolonia-svg-map .prefecture {
        stroke: #ffffff;
        stroke-width: 2;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .geolonia-svg-map .prefecture:hover {
        filter: brightness(0.85);
        stroke: #333;
        stroke-width: 3;
      }

      .geolonia-svg-map .boundary-line {
        stroke: #999999;
        stroke-width: 1;
      }

      /* åœ°æ–¹åŒºåˆ†é¢œè‰² */
      .hokkaido {
        fill: #ff6b6b;
      }
      .tohoku {
        fill: #4ecdc4;
      }
      .kanto {
        fill: #45b7d1;
      }
      .chubu {
        fill: #ffa07a;
      }
      .kinki {
        fill: #98d8c8;
      }
      .chugoku {
        fill: #f7dc6f;
      }
      .shikoku {
        fill: #bb8fce;
      }
      .kyushu-okinawa {
        fill: #85c1e2;
      }

      .info-box {
        position: fixed;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        pointer-events: none;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        max-width: 250px;
      }

      .info-box.show {
        display: block;
      }

      .info-box h3 {
        margin-bottom: 8px;
        font-size: 1.3em;
        border-bottom: 2px solid white;
        padding-bottom: 5px;
      }

      .info-box p {
        margin: 5px 0;
        font-size: 0.9em;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        h1 {
          font-size: 1.8em;
          margin-bottom: 15px;
        }

        .map-container {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ—¾ æ—¥æœ¬åœ°å›¾ - å…«å¤§åœ°æ–¹åŒºåˆ†</h1>

      <div class="map-container">
        <div id="map"></div>
      </div>
    </div>

    <div class="info-box" id="infoBox">
      <h3 id="prefName"></h3>
      <p><strong>åœ°æ–¹:</strong> <span id="regionName"></span></p>
      <p><strong>éƒ½é“åºœå¿ä»£ç :</strong> <span id="prefCode"></span></p>
    </div>

    <script>
      // åœ°æ–¹åŒºåˆ†æ˜ å°„ï¼ˆæ—¥æ–‡åˆ°ä¸­æ–‡ï¼‰
      const regionMap = {
        hokkaido: "åŒ—æµ·é“åœ°æ–¹",
        tohoku: "ä¸œåŒ—åœ°æ–¹",
        kanto: "å…³ä¸œåœ°æ–¹",
        chubu: "ä¸­éƒ¨åœ°æ–¹",
        kinki: "è¿‘ç•¿åœ°æ–¹",
        chugoku: "ä¸­å›½åœ°æ–¹",
        shikoku: "å››å›½åœ°æ–¹",
        "kyushu-okinawa": "ä¹å·-å†²ç»³åœ°æ–¹",
      };

      async function initMap() {
        try {
          // æ ¹æ®å±å¹•å®½åº¦é€‰æ‹©åˆé€‚çš„ SVG æ–‡ä»¶
          const isMobile = window.innerWidth <= 768;
          const svgFile = isMobile ? "./map-mobile.svg" : "./map-full.svg";

          console.log(`åŠ è½½ ${isMobile ? "ç§»åŠ¨ç‰ˆ" : "å®Œæ•´ç‰ˆ"} åœ°å›¾...`);

          // è·å–æœ¬åœ° SVG æ–‡ä»¶
          const response = await fetch(svgFile);
          const svgText = await response.text();

          // æ’å…¥åˆ°é¡µé¢
          document.getElementById("map").innerHTML = svgText;

          // è·å– SVG å…ƒç´ 
          const svg = document.querySelector(".geolonia-svg-map");

          // åˆ é™¤é¡¶å±‚çš„ title æ ‡ç­¾ï¼Œé¿å…æ˜¾ç¤º "Japanese Prefectures" tooltip
          const svgTitle = svg.querySelector("title");
          if (svgTitle && !svgTitle.closest(".prefecture")) {
            svgTitle.remove();
          }

          // ä¸ºæ¯ä¸ªéƒ½é“åºœå¿æ·»åŠ äº¤äº’
          const prefectures = document.querySelectorAll(
            ".geolonia-svg-map .prefecture"
          );

          prefectures.forEach((prefecture) => {
            const titleElement = prefecture.querySelector("title");
            const prefName = titleElement.textContent.split("/")[0].trim();
            const prefCode = prefecture.getAttribute("data-code");

            // è·å–åœ°æ–¹åŒºåˆ†çš„ç±»å
            const classList = prefecture.classList;
            let regionClass = "";
            classList.forEach((cls) => {
              if (regionMap[cls]) {
                regionClass = cls;
              }
            });

            // é¼ æ ‡æ‚¬åœæ•ˆæœ
            prefecture.addEventListener("mouseenter", (e) => {
              const infoBox = document.getElementById("infoBox");
              document.getElementById("prefName").textContent = prefName;
              document.getElementById("regionName").textContent =
                regionMap[regionClass] || "æœªçŸ¥";
              document.getElementById("prefCode").textContent = prefCode;
              infoBox.classList.add("show");
            });

            prefecture.addEventListener("mousemove", (e) => {
              const infoBox = document.getElementById("infoBox");
              const offsetX = 20;
              const offsetY = 20;

              // è·å–ä¿¡æ¯æ¡†çš„å°ºå¯¸
              const boxWidth = infoBox.offsetWidth;
              const boxHeight = infoBox.offsetHeight;

              // è·å–è§†å£å°ºå¯¸
              const viewportWidth = window.innerWidth;
              const viewportHeight = window.innerHeight;

              // è®¡ç®—é»˜è®¤ä½ç½®ï¼ˆé¼ æ ‡å³ä¸‹æ–¹ï¼‰
              let left = e.pageX + offsetX;
              let top = e.pageY + offsetY;

              // å¦‚æœå³ä¾§è¶…å‡ºå±å¹•ï¼Œåˆ™æ˜¾ç¤ºåœ¨é¼ æ ‡å·¦ä¾§
              if (left + boxWidth > viewportWidth) {
                left = e.pageX - boxWidth - offsetX;
              }

              // å¦‚æœä¸‹æ–¹è¶…å‡ºå±å¹•ï¼Œåˆ™æ˜¾ç¤ºåœ¨é¼ æ ‡ä¸Šæ–¹
              if (top + boxHeight > viewportHeight) {
                top = e.pageY - boxHeight - offsetY;
              }

              // ç¡®ä¿ä¸ä¼šè¶…å‡ºå·¦è¾¹ç•Œå’Œä¸Šè¾¹ç•Œ
              left = Math.max(10, left);
              top = Math.max(10, top);

              infoBox.style.left = left + "px";
              infoBox.style.top = top + "px";
            });

            prefecture.addEventListener("mouseleave", () => {
              document.getElementById("infoBox").classList.remove("show");
            });
          });

          console.log("åœ°å›¾åŠ è½½æˆåŠŸï¼");
        } catch (error) {
          console.error("åŠ è½½åœ°å›¾å¤±è´¥:", error);
          document.getElementById("map").innerHTML =
            '<p style="color: red; text-align: center;">åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿ svg æ–‡ä»¶ä¸ HTML æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚</p>';
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åœ°å›¾
      window.addEventListener("DOMContentLoaded", initMap);

      // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œå¿…è¦æ—¶é‡æ–°åŠ è½½åœ°å›¾
      let resizeTimer;
      let currentMapType = window.innerWidth <= 768 ? "mobile" : "full";

      window.addEventListener("resize", () => {
        // é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è§¦å‘
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          const isMobile = window.innerWidth <= 768;
          const newMapType = isMobile ? "mobile" : "full";

          // åªæœ‰åœ¨åœ°å›¾ç±»å‹çœŸæ­£æ”¹å˜æ—¶æ‰é‡æ–°åŠ è½½
          if (newMapType !== currentMapType) {
            currentMapType = newMapType;
            console.log(
              `å±å¹•å°ºå¯¸å˜åŒ–ï¼Œåˆ‡æ¢åˆ°${isMobile ? "ç§»åŠ¨ç‰ˆ" : "å®Œæ•´ç‰ˆ"}åœ°å›¾`
            );
            initMap();
          }
        }, 500); // 500ms é˜²æŠ–å»¶è¿Ÿ
      });
    </script>
  </body>
</html>
